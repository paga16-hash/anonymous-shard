<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-report/implementation/implementation" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Implementation | Anonymous Shard</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://paga16-hash.github.io/anonymous-shard/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://paga16-hash.github.io/anonymous-shard/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://paga16-hash.github.io/anonymous-shard/docs/report/implementation/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Implementation | Anonymous Shard"><meta data-rh="true" name="description" content="From the detailed design section, the system exploits a lot of interfaces fixing the business logic and the separation of concerns also before the real implementation. One of the principles that have been followed is the Dependency Inversion Principle that is a key principle of the Clean Architecture."><meta data-rh="true" property="og:description" content="From the detailed design section, the system exploits a lot of interfaces fixing the business logic and the separation of concerns also before the real implementation. One of the principles that have been followed is the Dependency Inversion Principle that is a key principle of the Clean Architecture."><link data-rh="true" rel="icon" href="/anonymous-shard/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://paga16-hash.github.io/anonymous-shard/docs/report/implementation/"><link data-rh="true" rel="alternate" href="https://paga16-hash.github.io/anonymous-shard/docs/report/implementation/" hreflang="en"><link data-rh="true" rel="alternate" href="https://paga16-hash.github.io/anonymous-shard/docs/report/implementation/" hreflang="x-default"><link rel="stylesheet" href="/anonymous-shard/assets/css/styles.87eb4ffa.css">
<script src="/anonymous-shard/assets/js/runtime~main.fa5fdd68.js" defer="defer"></script>
<script src="/anonymous-shard/assets/js/main.add682fd.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/anonymous-shard/"><div class="navbar__logo"><img src="/anonymous-shard/img/logo.svg" alt="Anonymous Shard Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/anonymous-shard/img/logo.svg" alt="Anonymous Shard Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Anonymous Shard</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/anonymous-shard/docs/category/report">Report</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/paga16-hash/anonymous-shard" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/anonymous-shard/docs/category/report">Report</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/anonymous-shard/docs/report/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/anonymous-shard/docs/category/analysis">Analysis</a><button aria-label="Expand sidebar category &#x27;Analysis&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/anonymous-shard/docs/category/domain-driven-design">(Domain-Driven) Design</a><button aria-label="Expand sidebar category &#x27;(Domain-Driven) Design&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/anonymous-shard/docs/category/implementation">Implementation</a><button aria-label="Collapse sidebar category &#x27;Implementation&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/anonymous-shard/docs/report/implementation/">Implementation</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/anonymous-shard/docs/report/devops">DevOps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/anonymous-shard/docs/report/testing">Testing and Evaluation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/anonymous-shard/docs/category/deployment">Deployment</a><button aria-label="Expand sidebar category &#x27;Deployment&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/anonymous-shard/docs/report/conclusions">Conclusions</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/anonymous-shard/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/anonymous-shard/docs/category/report"><span itemprop="name">Report</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/anonymous-shard/docs/category/implementation"><span itemprop="name">Implementation</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Implementation</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Implementation</h1></header>
<p>From the detailed design section, the system exploits a lot of interfaces fixing the business logic and the separation of concerns also before the real implementation. One of the principles that have been followed is the <strong>Dependency Inversion Principle</strong> that is a key principle of the Clean Architecture.</p>
<p>It is a concept in software design that helps keep different parts of a system loosely coupled. It states that high-level modules (which define business logic) should not directly depend on low-level modules (such as databases or network connections). Instead, both should rely on abstractions.</p>
<p>Improving <strong>flexibility</strong> and <strong>maintainability</strong> without impacting the core logic. Another pro is that this principle makes it easier to test the codebase as it allows for the use of mock objects to simulate dependencies during testing, a feature that is particularly useful in possible future testing phases.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="technologies">Technologies<a href="#technologies" class="hash-link" aria-label="Direct link to Technologies" title="Direct link to Technologies">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="programming-language">Programming Language<a href="#programming-language" class="hash-link" aria-label="Direct link to Programming Language" title="Direct link to Programming Language">​</a></h3>
<p>The programming language chosen for the implementation is <strong>TypeScript</strong>, a superset of JavaScript that adds static typing to the language. This choice has been made to ensure a more robust codebase and to leverage the benefits of static typing during the development phase. Moreover, TypeScript is widely used in the industry and has a large community, making it easier to find resources and support, especially for a project that aims to be open-source.</p>
<p>Some cons of TypeScript are the learning curve and the compilation time that can be longer than JavaScript, but the benefits in terms of code quality and maintainability outweigh the cons. In this case, I was also familiar with TypeScript, so the choice was natural. This choice is not a constraint for the possible creation of other typologies of nodes because once the interfaces and communication patterns are defined, the implementation can be done in any language.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="express">Express<a href="#express" class="hash-link" aria-label="Direct link to Express" title="Direct link to Express">​</a></h3>
<p><strong><a href="https://expressjs.com/" target="_blank" rel="noopener noreferrer">Express</a></strong> is a minimal and flexible Node.js web application framework that provides a robust set of features for web apps. In this project, Express is used to create the REST API layer that exposes the system monitoring functionalities to the user. The choice of Express was made because of its simplicity, making it ideal but not for any particular constraint.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tor">Tor<a href="#tor" class="hash-link" aria-label="Direct link to Tor" title="Direct link to Tor">​</a></h3>
<p><strong><a href="https://www.torproject.org/" target="_blank" rel="noopener noreferrer">Tor</a></strong> (The Onion Router) is a privacy-focused network that enables anonymous communication by routing traffic through a series of encrypted relays. It adds an extra layer of security by encrypting data multiple times, ensuring that the data inside the network remains hidden. In this system, Tor is used to anonymize communications between nodes, ensuring that the identity and location of participants remain undisclosed. Tor offers <strong>Hidden Services</strong> that allow services to be hosted on the tor network. The choice of Tor was made due to its strong anonymity guarantees.</p>
<p>An <strong><a href="https://tb-manual.torproject.org/onion-services/" target="_blank" rel="noopener noreferrer">Hidden Service</a></strong> is a service that is only accessible through the Tor network. It is a server that is configured to receive inbound connections only through the Tor network, ensuring that the server&#x27;s location remains hidden.</p>
<p>It offers a series of advantages that are fundamental for this system:</p>
<ol>
<li><strong>Anonymity:</strong> The IP address of an onion service remains hidden, protecting both users and operators.</li>
<li><strong>Encryption:</strong> All traffic between users and the onion service is encrypted at the network level. However, it is important to note that this encryption applies only to the transport layer within the Tor network. In general, once the data reaches the onion service, its security depends on how the service processes and stores it. If the service does not implement additional encryption or security mechanisms, sensitive information could still be exposed or vulnerable to attacks on the server side.</li>
<li><strong>Automatic Address Generation:</strong> Users do not need to buy domain names; onion addresses are cryptographically generated.</li>
<li><strong>Integrity Assurance:</strong> The .onion URL itself ensures users connect to the correct service without risk of tampering.</li>
</ol>
<p>To access an onion service, users must know its .onion address, which consists of 56 alphanumeric characters followed by <code>.onion</code>. Additionally, websites can implement the <code>Onion-Location</code> header, allowing automatic redirection to their onion counterpart.</p>
<p>A possible enhancement involves authenticated onion services, which require users to provide an authentication token before gaining access. This strengthens security by restricting access to authorized users only. Tor Browser supports this mechanism, allowing users to enter a private key when prompted.</p>
<p>An encountered problem while the containerization process of the system inherent to how Hidden Services are managed by Tor can be found in the Deployment Chapter.</p>
<p><strong><a href="https://support.torproject.org/about/entry-guards/" target="_blank" rel="noopener noreferrer">Entry Nodes</a></strong> (or <strong>Guard Nodes</strong>) are the first relay point your traffic passes through when connecting to Tor. They are responsible for establishing the connection between your device and the Tor network, providing anonymity by masking your real IP address.</p>
<p><strong><a href="https://blog.torproject.org/tips-running-exit-node/" target="_blank" rel="noopener noreferrer">Exit Nodes</a></strong> are the last relay in the Tor network that your traffic passes through before reaching its final destination. They are responsible for sending the encrypted traffic and decrypting the final layer of encryption. However, the exit node can see your traffic’s destination but not its source (IP address). An updated list of the Tor Relays and a lot of interesting metrics can be found <a href="https://metrics.torproject.org/rs.html" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p><img decoding="async" loading="lazy" alt="Mapped Exit node" src="/anonymous-shard/assets/images/exit-and-entry-nodes-ac16fe968a5737bd39905c617003ca8a.png" width="1848" height="954" class="img_ev3q">
<em>Figure: Mapped Exit node</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ipfs">IPFS<a href="#ipfs" class="hash-link" aria-label="Direct link to IPFS" title="Direct link to IPFS">​</a></h3>
<p><strong><a href="https://ipfs.tech/" target="_blank" rel="noopener noreferrer">IPFS</a></strong> (InterPlanetary File System) is a distributed, peer-to-peer network for storing and sharing data in a decentralized manner. Instead of relying on a central server, IPFS uses content-addressing, where each file is identified by its cryptographic hash, ensuring immutability and resistance to censorship. In this system, it is used to store and retrieve data efficiently avoiding reliance on centralized storage solutions. This choice was made because of its decentralized architecture and data persistence.</p>
<p>The problem encountered here is that, as mentioned, this technology exploits content-addressing, so once the data are stored on IPFS they become immutable. Moreover, the stored data are not encrypted by default, so it is necessary to encrypt them before storing to ensure privacy and confidentiality. In this system, it is used to persist the info about tasks and tasks results. The design choice to avoid the storage of clear data on IPFS is the generation of a key pair by the consumer node that is used to encrypt the result before the storage. Mechanism deepened in Security Pattern Section.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="pinata">Pinata<a href="#pinata" class="hash-link" aria-label="Direct link to Pinata" title="Direct link to Pinata">​</a></h4>
<p>Pinata is a cloud-based service that simplifies storing and managing files on IPFS (InterPlanetary File System). It has been used for simplicity and to avoid the need to run a self-hosted IPFS node, considered time-consuming for a prototype. It provides a web interface, API access, and pinning services and some technical documentation that helps the developing process.</p>
<p>Unlike self-hosted IPFS nodes, Pinata is ideal for those who don&#x27;t want to maintain their own infrastructure. In this case, besides the fact that the system is a prototype and a self-hosted IPFS node would be excessive, it was very interesting to understand how it works. This technology is widely used in NFTs, Web3 applications, and decentralized storage solutions, offering scalability, access control, and analytics.</p>
<p>Beyond this, however, the main purpose of the system would require one or more independent nodes to maintain the system decentralized.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="socks5-proxy">SOCKS5 Proxy<a href="#socks5-proxy" class="hash-link" aria-label="Direct link to SOCKS5 Proxy" title="Direct link to SOCKS5 Proxy">​</a></h3>
<p><strong><a href="https://support.torproject.org/glossary/socks5/" target="_blank" rel="noopener noreferrer">SOCKS5</a></strong> is a networking protocol that routes network packets between a client and a server through a proxy server. In this system, every communication is tunneled through a SOCKS5 proxy to ensure anonymity and privacy when <em>Anonymous Mode</em> is enabled. As mentioned in the Background Section, the choice of SOCKS5 was made because of the Tor network&#x27;s support for this protocol, making it ideal for routing network traffic through that network. Moreover, this type of proxy supports various protocols, and with this fifth version, also the UDP, that is a nice feature. The problem is that the UDP protocol is not supported by the Tor network, so it is not used in this system.</p>
<p>Briefly, this proxy mechanism is very powerful; it allows the system to transparently route packets through an intermediate relay, preserving anonymity while maintaining efficient communication.</p>
<p>General key advantages of using this proxy include:</p>
<ol>
<li><strong>Anonymity and Privacy:</strong> When running in anonymous mode, all network traffic is routed through the SOCKS5 proxy.</li>
<li><strong>Protocol Agnosticism:</strong> Unlike HTTP proxies, SOCKS5 supports various protocols.</li>
<li><strong>Flexible Traffic Routing:</strong> The system can dynamically switch between direct connections and proxy-based routing, depending on whether anonymity is required.</li>
<li><strong>Reliability in Restricted Environments:</strong> SOCKS5 helps bypass network restrictions, making it possible to maintain peer communication even in constrained environments.</li>
</ol>
<p>With its <strong>5h</strong> version, instead, the resolution of DNS queries is possible at the proxy level. In this specific case, the system uses the Tor network, which already provides DNS resolution, so this feature is not exploited. In general, this feature can enhance anonymity and can bypass DNS censorship or avoid DNS leaks.</p>
<p>An interesting feature, according to the <a href="https://support.torproject.org/it/misc/check-socks-dns-leaks/" target="_blank" rel="noopener noreferrer">Tor Documentation</a>, is that adding the <code>SafeSocks 1</code> directive in the <code>torrc</code> file prevents DNS leaks by ensuring that all DNS requests are routed through the Tor network. This configuration rejects any connection attempting to resolve DNS outside of Tor, safeguarding the user.</p>
<p>In the implementation, all peer communications for <strong>event-driven messaging</strong> are transparently tunneled through the SOCKS5 proxy when operating in anonymous mode. In this system, the proxy is provided directly by the Tor installation. Below, a code snippet shows how the system establishes a connection to a peer through the proxy.</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token maybe-class-name">SocksClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createConnection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">proxy</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">host</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;127.0.0.1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">port</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9050</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// SOCKS5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">command</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;connect&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">destination</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">host</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;peer-address.onion&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">port</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="socks5h-version">SOCKS5h Version<a href="#socks5h-version" class="hash-link" aria-label="Direct link to SOCKS5h Version" title="Direct link to SOCKS5h Version">​</a></h3>
<p>To use the SOCKS5h version, the <code>type</code> field in the proxy configuration object must still be set to the value <code>5</code>, but a Lookup Function must be provided to set the DNS lookup to the proxy server. This depends on the library used to establish the connection. In this case, the <strong><a href="https://www.npmjs.com/package/socks" target="_blank" rel="noopener noreferrer">socks</a></strong> module has been exploited.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="docker">Docker<a href="#docker" class="hash-link" aria-label="Direct link to Docker" title="Direct link to Docker">​</a></h3>
<p><strong><a href="https://www.docker.com/" target="_blank" rel="noopener noreferrer">Docker</a></strong> is a containerization platform that allows applications to run in isolated environments, ensuring consistency across different systems. It enables the packaging of software and its dependencies into lightweight containers, making deployment more efficient and reproducible. In this system, Docker is used to encapsulate various components, ensuring that they run in a controlled and consistent manner across different machines. The choice of Docker was made to simplify deployment, enhance portability, and manage dependencies efficiently.</p>
<p>In this particular system, the exploitation of Docker <em>Volumes</em> brings the possibility to store the data outside the container, ensuring data persistence even for a consumer that wants to submit tasks always using different Hidden Service onion addresses. This is possible because the system is configured to store the hidden service private key in a volume that is shared with the container. For more explanations about job unit submissions, refer to the Data Flow Analysis Figure, while for the specific containerization process, where this feature is exploited, continue to the Deployment Chapter.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="transport-layer">Transport Layer<a href="#transport-layer" class="hash-link" aria-label="Direct link to Transport Layer" title="Direct link to Transport Layer">​</a></h3>
<p>One of the main challenges in this system was to ensure secure and anonymous communication between peers. In the early stage of the implementation, after fixing the business logic, architecture, and the main components, the focus was on searching for a good library that could help achieve this prototype. The attention was particularly on <strong><a href="https://libp2p.io/" target="_blank" rel="noopener noreferrer">libp2p.io</a></strong>, a modular network stack that can be used to build peer-to-peer applications. This library has gained popularity and is now affirmed in the peer-to-peer community. This modular and extensible framework, adapted across many programming languages (JavaScript, Go, Rust, C++, Nim, Java/Kotlin, Python, Swift, etc.), has facilitated its integration into numerous high-profile projects.</p>
<p>For example, <strong>Ethereum blockchain</strong>, <strong>IPFS</strong>, <strong>Filecoin</strong>, <strong>Polkadot</strong>, and many others are using libp2p to build their network stack.</p>
<p>The ongoing development and adoption of libp2p underscore its critical role in decentralized technologies, making it an ideal choice for this system. The learning curve of this library is the only downside. While for simple projects, the library can be easily introduced and used, for complex projects it can be difficult to manipulate and understand all the features to reach the desired result.</p>
<p>Moreover, in this case, the library is not designed to be used on top of the Tor network, so it requires additional workarounds to make it feasible.</p>
<p>The initial attempts to use this library in a &#x27;hacky&#x27; way (modifying the library code directly, which is not considered correct from a design perspective) were aborted because of the <strong>multiaddr</strong> resolution.<br>
<em>Multiaddr</em> is a flexible and multi-protocol address format used for identifying peers in a decentralized, peer-to-peer network. It allows a single identifier to represent a peer using multiple transport protocols and addresses.</p>
<p>Furthermore, for each update or fix of the library, it was necessary to manually modify the involved files or keep a fork of the library, which introduced security implications. This goes against good security and software engineering practices, so this development line was abandoned.</p>
<p>After discarding this possibility, an analysis and feasibility study was conducted to implement a new module for the library that could extend its functionality to support communications over the Tor network. What emerged is that the <strong><a href="https://www.npmjs.com/package/@libp2p/interface-transport" target="_blank" rel="noopener noreferrer">Transport Interface</a></strong> needs to be implemented to make a new compliant module (like <strong><a href="https://github.com/libp2p/js-libp2p-websockets" target="_blank" rel="noopener noreferrer">js-libp2p-websockets</a></strong>). I would have liked to contribute to the library, but the time was limited and the complexity of the task was high.</p>
<p>I should have investigated better where the library uses the UDP protocol to generate similar components that encapsulate this UDP traffic in TCP, possibly on Tor. Moreover, given the different nature of the two networks, it would have been necessary to implement a mechanism to manage different latencies, timeouts, name resolution mechanisms, and others in a cascading way.</p>
<p>Given the limited time and the fact that this development line could not yet lead to a concrete result, the decision was made, with regret, to continue discarding this possibility and use native sockets for communication between peers. Anyway, this has been a very interesting part of the development, and it has been a great opportunity to understand better how the library works and how it can be extended. Surely, more work and study are needed to make this library (or at least some components) work on top of the Tor network, but the potential is very high.</p>
<p>Another consideration regarding this possible development is that if I could have used the library, I could have focused on an even more complex system, moving towards an ecosystem concept. This, however, is normal in a prototype, where the focus is on the main abstractions and the quality of the architecture, and not on the complexity of the system.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="native-sockets">Native Sockets<a href="#native-sockets" class="hash-link" aria-label="Direct link to Native Sockets" title="Direct link to Native Sockets">​</a></h3>
<p>The communication between peers is managed through native sockets. The system uses the <strong>Node.js</strong> <code>net</code> module to establish connections between peers. Also, in this case, the transport layer is changed according to the operating mode of the system, in particular, the usage of the <strong>SOCKS5 Proxy</strong> to ensure anonymity and privacy, or not.</p>
<p>To achieve this, the DIP (Dependency Inversion Principle) has been followed again, creating an interface that abstracts the communication layer and implementing two different classes, one for each mode.</p>
<p>The main problem encountered in the anonymous mode is the management of the different latencies or network instability that can be introduced by the Tor network. To solve this problem, a retry mechanism has been implemented.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/anonymous-shard/docs/category/implementation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Implementation</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/anonymous-shard/docs/report/devops"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">DevOps</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#technologies" class="table-of-contents__link toc-highlight">Technologies</a><ul><li><a href="#programming-language" class="table-of-contents__link toc-highlight">Programming Language</a></li><li><a href="#express" class="table-of-contents__link toc-highlight">Express</a></li><li><a href="#tor" class="table-of-contents__link toc-highlight">Tor</a></li><li><a href="#ipfs" class="table-of-contents__link toc-highlight">IPFS</a></li><li><a href="#socks5-proxy" class="table-of-contents__link toc-highlight">SOCKS5 Proxy</a></li><li><a href="#socks5h-version" class="table-of-contents__link toc-highlight">SOCKS5h Version</a></li><li><a href="#docker" class="table-of-contents__link toc-highlight">Docker</a></li><li><a href="#transport-layer" class="table-of-contents__link toc-highlight">Transport Layer</a></li><li><a href="#native-sockets" class="table-of-contents__link toc-highlight">Native Sockets</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/anonymous-shard/docs/intro">Report</a></li><li class="footer__item"><a class="footer__link-item" href="/anonymous-shard/openapi">OpenAPI</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/paga16-hash/anonymous-shard" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Anonymous Shard. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>