"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[2493],{7401:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>l,frontMatter:()=>o,metadata:()=>a,toc:()=>h});var i=n(4848),s=n(8453);const o={},r="Implementation",a={id:"report/implementation/implementation",title:"Implementation",description:"From the detailed design section, the system exploits a lot of interfaces fixing the business logic and the separation of concerns also before the real implementation. One of the principles that have been followed is the Dependency Inversion Principle that is a key principle of the Clean Architecture.",source:"@site/docs/report/implementation/implementation.md",sourceDirName:"report/implementation",slug:"/report/implementation/",permalink:"/anonymous-shard/docs/report/implementation/",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Implementation",permalink:"/anonymous-shard/docs/category/implementation"},next:{title:"DevOps",permalink:"/anonymous-shard/docs/report/devops"}},c={},h=[{value:"Technologies",id:"technologies",level:2},{value:"Programming Language",id:"programming-language",level:3},{value:"Express",id:"express",level:3},{value:"Tor",id:"tor",level:3},{value:"IPFS",id:"ipfs",level:3},{value:"Pinata",id:"pinata",level:4},{value:"SOCKS5 Proxy",id:"socks5-proxy",level:3},{value:"SOCKS5h Version",id:"socks5h-version",level:3},{value:"Docker",id:"docker",level:3},{value:"Transport Layer",id:"transport-layer",level:3},{value:"Native Sockets",id:"native-sockets",level:3}];function d(e){const t={a:"a",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"implementation",children:"Implementation"})}),"\n",(0,i.jsxs)(t.p,{children:["From the detailed design section, the system exploits a lot of interfaces fixing the business logic and the separation of concerns also before the real implementation. One of the principles that have been followed is the ",(0,i.jsx)(t.strong,{children:"Dependency Inversion Principle"})," that is a key principle of the Clean Architecture."]}),"\n",(0,i.jsx)(t.p,{children:"It is a concept in software design that helps keep different parts of a system loosely coupled. It states that high-level modules (which define business logic) should not directly depend on low-level modules (such as databases or network connections). Instead, both should rely on abstractions."}),"\n",(0,i.jsxs)(t.p,{children:["Improving ",(0,i.jsx)(t.strong,{children:"flexibility"})," and ",(0,i.jsx)(t.strong,{children:"maintainability"})," without impacting the core logic. Another pro is that this principle makes it easier to test the codebase as it allows for the use of mock objects to simulate dependencies during testing, a feature that is particularly useful in possible future testing phases."]}),"\n",(0,i.jsx)(t.h2,{id:"technologies",children:"Technologies"}),"\n",(0,i.jsx)(t.h3,{id:"programming-language",children:"Programming Language"}),"\n",(0,i.jsxs)(t.p,{children:["The programming language chosen for the implementation is ",(0,i.jsx)(t.strong,{children:"TypeScript"}),", a superset of JavaScript that adds static typing to the language. This choice has been made to ensure a more robust codebase and to leverage the benefits of static typing during the development phase. Moreover, TypeScript is widely used in the industry and has a large community, making it easier to find resources and support, especially for a project that aims to be open-source."]}),"\n",(0,i.jsx)(t.p,{children:"Some cons of TypeScript are the learning curve and the compilation time that can be longer than JavaScript, but the benefits in terms of code quality and maintainability outweigh the cons. In this case, I was also familiar with TypeScript, so the choice was natural. This choice is not a constraint for the possible creation of other typologies of nodes because once the interfaces and communication patterns are defined, the implementation can be done in any language."}),"\n",(0,i.jsx)(t.h3,{id:"express",children:"Express"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:(0,i.jsx)(t.a,{href:"https://expressjs.com/",children:"Express"})})," is a minimal and flexible Node.js web application framework that provides a robust set of features for web apps. In this project, Express is used to create the REST API layer that exposes the system monitoring functionalities to the user. The choice of Express was made because of its simplicity, making it ideal but not for any particular constraint."]}),"\n",(0,i.jsx)(t.h3,{id:"tor",children:"Tor"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:(0,i.jsx)(t.a,{href:"https://www.torproject.org/",children:"Tor"})})," (The Onion Router) is a privacy-focused network that enables anonymous communication by routing traffic through a series of encrypted relays. It adds an extra layer of security by encrypting data multiple times, ensuring that the data inside the network remains hidden. In this system, Tor is used to anonymize communications between nodes, ensuring that the identity and location of participants remain undisclosed. Tor offers ",(0,i.jsx)(t.strong,{children:"Hidden Services"})," that allow services to be hosted on the tor network. The choice of Tor was made due to its strong anonymity guarantees."]}),"\n",(0,i.jsxs)(t.p,{children:["An ",(0,i.jsx)(t.strong,{children:(0,i.jsx)(t.a,{href:"https://tb-manual.torproject.org/onion-services/",children:"Hidden Service"})})," is a service that is only accessible through the Tor network. It is a server that is configured to receive inbound connections only through the Tor network, ensuring that the server's location remains hidden."]}),"\n",(0,i.jsx)(t.p,{children:"It offers a series of advantages that are fundamental for this system:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Anonymity:"})," The IP address of an onion service remains hidden, protecting both users and operators."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Encryption:"})," All traffic between users and the onion service is encrypted at the network level. However, it is important to note that this encryption applies only to the transport layer within the Tor network. In general, once the data reaches the onion service, its security depends on how the service processes and stores it. If the service does not implement additional encryption or security mechanisms, sensitive information could still be exposed or vulnerable to attacks on the server side."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Automatic Address Generation:"})," Users do not need to buy domain names; onion addresses are cryptographically generated."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Integrity Assurance:"})," The .onion URL itself ensures users connect to the correct service without risk of tampering."]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["To access an onion service, users must know its .onion address, which consists of 56 alphanumeric characters followed by ",(0,i.jsx)(t.code,{children:".onion"}),". Additionally, websites can implement the ",(0,i.jsx)(t.code,{children:"Onion-Location"})," header, allowing automatic redirection to their onion counterpart."]}),"\n",(0,i.jsx)(t.p,{children:"A possible enhancement involves authenticated onion services, which require users to provide an authentication token before gaining access. This strengthens security by restricting access to authorized users only. Tor Browser supports this mechanism, allowing users to enter a private key when prompted."}),"\n",(0,i.jsx)(t.p,{children:"An encountered problem while the containerization process of the system inherent to how Hidden Services are managed by Tor can be found in the Deployment Chapter."}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:(0,i.jsx)(t.a,{href:"https://support.torproject.org/about/entry-guards/",children:"Entry Nodes"})})," (or ",(0,i.jsx)(t.strong,{children:"Guard Nodes"}),") are the first relay point your traffic passes through when connecting to Tor. They are responsible for establishing the connection between your device and the Tor network, providing anonymity by masking your real IP address."]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:(0,i.jsx)(t.a,{href:"https://blog.torproject.org/tips-running-exit-node/",children:"Exit Nodes"})})," are the last relay in the Tor network that your traffic passes through before reaching its final destination. They are responsible for sending the encrypted traffic and decrypting the final layer of encryption. However, the exit node can see your traffic\u2019s destination but not its source (IP address). An updated list of the Tor Relays and a lot of interesting metrics can be found ",(0,i.jsx)(t.a,{href:"https://metrics.torproject.org/rs.html",children:"here"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.img,{alt:"Mapped Exit node",src:n(6498).A+"",width:"1848",height:"954"}),"\n",(0,i.jsx)(t.em,{children:"Figure: Mapped Exit node"})]}),"\n",(0,i.jsx)(t.h3,{id:"ipfs",children:"IPFS"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:(0,i.jsx)(t.a,{href:"https://ipfs.tech/",children:"IPFS"})})," (InterPlanetary File System) is a distributed, peer-to-peer network for storing and sharing data in a decentralized manner. Instead of relying on a central server, IPFS uses content-addressing, where each file is identified by its cryptographic hash, ensuring immutability and resistance to censorship. In this system, it is used to store and retrieve data efficiently avoiding reliance on centralized storage solutions. This choice was made because of its decentralized architecture and data persistence."]}),"\n",(0,i.jsx)(t.p,{children:"The problem encountered here is that, as mentioned, this technology exploits content-addressing, so once the data are stored on IPFS they become immutable. Moreover, the stored data are not encrypted by default, so it is necessary to encrypt them before storing to ensure privacy and confidentiality. In this system, it is used to persist the info about tasks and tasks results. The design choice to avoid the storage of clear data on IPFS is the generation of a key pair by the consumer node that is used to encrypt the result before the storage. Mechanism deepened in Security Pattern Section."}),"\n",(0,i.jsx)(t.h4,{id:"pinata",children:"Pinata"}),"\n",(0,i.jsx)(t.p,{children:"Pinata is a cloud-based service that simplifies storing and managing files on IPFS (InterPlanetary File System). It has been used for simplicity and to avoid the need to run a self-hosted IPFS node, considered time-consuming for a prototype. It provides a web interface, API access, and pinning services and some technical documentation that helps the developing process."}),"\n",(0,i.jsx)(t.p,{children:"Unlike self-hosted IPFS nodes, Pinata is ideal for those who don't want to maintain their own infrastructure. In this case, besides the fact that the system is a prototype and a self-hosted IPFS node would be excessive, it was very interesting to understand how it works. This technology is widely used in NFTs, Web3 applications, and decentralized storage solutions, offering scalability, access control, and analytics."}),"\n",(0,i.jsx)(t.p,{children:"Beyond this, however, the main purpose of the system would require one or more independent nodes to maintain the system decentralized."}),"\n",(0,i.jsx)(t.h3,{id:"socks5-proxy",children:"SOCKS5 Proxy"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:(0,i.jsx)(t.a,{href:"https://support.torproject.org/glossary/socks5/",children:"SOCKS5"})})," is a networking protocol that routes network packets between a client and a server through a proxy server. In this system, every communication is tunneled through a SOCKS5 proxy to ensure anonymity and privacy when ",(0,i.jsx)(t.em,{children:"Anonymous Mode"})," is enabled. As mentioned in the Background Section, the choice of SOCKS5 was made because of the Tor network's support for this protocol, making it ideal for routing network traffic through that network. Moreover, this type of proxy supports various protocols, and with this fifth version, also the UDP, that is a nice feature. The problem is that the UDP protocol is not supported by the Tor network, so it is not used in this system."]}),"\n",(0,i.jsx)(t.p,{children:"Briefly, this proxy mechanism is very powerful; it allows the system to transparently route packets through an intermediate relay, preserving anonymity while maintaining efficient communication."}),"\n",(0,i.jsx)(t.p,{children:"General key advantages of using this proxy include:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Anonymity and Privacy:"})," When running in anonymous mode, all network traffic is routed through the SOCKS5 proxy."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Protocol Agnosticism:"})," Unlike HTTP proxies, SOCKS5 supports various protocols."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Flexible Traffic Routing:"})," The system can dynamically switch between direct connections and proxy-based routing, depending on whether anonymity is required."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Reliability in Restricted Environments:"})," SOCKS5 helps bypass network restrictions, making it possible to maintain peer communication even in constrained environments."]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["With its ",(0,i.jsx)(t.strong,{children:"5h"})," version, instead, the resolution of DNS queries is possible at the proxy level. In this specific case, the system uses the Tor network, which already provides DNS resolution, so this feature is not exploited. In general, this feature can enhance anonymity and can bypass DNS censorship or avoid DNS leaks."]}),"\n",(0,i.jsxs)(t.p,{children:["An interesting feature, according to the ",(0,i.jsx)(t.a,{href:"https://support.torproject.org/it/misc/check-socks-dns-leaks/",children:"Tor Documentation"}),", is that adding the ",(0,i.jsx)(t.code,{children:"SafeSocks 1"})," directive in the ",(0,i.jsx)(t.code,{children:"torrc"})," file prevents DNS leaks by ensuring that all DNS requests are routed through the Tor network. This configuration rejects any connection attempting to resolve DNS outside of Tor, safeguarding the user."]}),"\n",(0,i.jsxs)(t.p,{children:["In the implementation, all peer communications for ",(0,i.jsx)(t.strong,{children:"event-driven messaging"})," are transparently tunneled through the SOCKS5 proxy when operating in anonymous mode. In this system, the proxy is provided directly by the Tor installation. Below, a code snippet shows how the system establishes a connection to a peer through the proxy."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"await SocksClient.createConnection({\n    proxy:\n\n {\n        host: '127.0.0.1',\n        port: 9050,\n        type: 5 // SOCKS5\n    },\n    command: 'connect',\n    destination: {\n        host: 'peer-address.onion',\n        port: 8080\n    }\n});\n"})}),"\n",(0,i.jsx)(t.h3,{id:"socks5h-version",children:"SOCKS5h Version"}),"\n",(0,i.jsxs)(t.p,{children:["To use the SOCKS5h version, the ",(0,i.jsx)(t.code,{children:"type"})," field in the proxy configuration object must still be set to the value ",(0,i.jsx)(t.code,{children:"5"}),", but a Lookup Function must be provided to set the DNS lookup to the proxy server. This depends on the library used to establish the connection. In this case, the ",(0,i.jsx)(t.strong,{children:(0,i.jsx)(t.a,{href:"https://www.npmjs.com/package/socks",children:"socks"})})," module has been exploited."]}),"\n",(0,i.jsx)(t.h3,{id:"docker",children:"Docker"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:(0,i.jsx)(t.a,{href:"https://www.docker.com/",children:"Docker"})})," is a containerization platform that allows applications to run in isolated environments, ensuring consistency across different systems. It enables the packaging of software and its dependencies into lightweight containers, making deployment more efficient and reproducible. In this system, Docker is used to encapsulate various components, ensuring that they run in a controlled and consistent manner across different machines. The choice of Docker was made to simplify deployment, enhance portability, and manage dependencies efficiently."]}),"\n",(0,i.jsxs)(t.p,{children:["In this particular system, the exploitation of Docker ",(0,i.jsx)(t.em,{children:"Volumes"})," brings the possibility to store the data outside the container, ensuring data persistence even for a consumer that wants to submit tasks always using different Hidden Service onion addresses. This is possible because the system is configured to store the hidden service private key in a volume that is shared with the container. For more explanations about job unit submissions, refer to the Data Flow Analysis Figure, while for the specific containerization process, where this feature is exploited, continue to the Deployment Chapter."]}),"\n",(0,i.jsx)(t.h3,{id:"transport-layer",children:"Transport Layer"}),"\n",(0,i.jsxs)(t.p,{children:["One of the main challenges in this system was to ensure secure and anonymous communication between peers. In the early stage of the implementation, after fixing the business logic, architecture, and the main components, the focus was on searching for a good library that could help achieve this prototype. The attention was particularly on ",(0,i.jsx)(t.strong,{children:(0,i.jsx)(t.a,{href:"https://libp2p.io/",children:"libp2p.io"})}),", a modular network stack that can be used to build peer-to-peer applications. This library has gained popularity and is now affirmed in the peer-to-peer community. This modular and extensible framework, adapted across many programming languages (JavaScript, Go, Rust, C++, Nim, Java/Kotlin, Python, Swift, etc.), has facilitated its integration into numerous high-profile projects."]}),"\n",(0,i.jsxs)(t.p,{children:["For example, ",(0,i.jsx)(t.strong,{children:"Ethereum blockchain"}),", ",(0,i.jsx)(t.strong,{children:"IPFS"}),", ",(0,i.jsx)(t.strong,{children:"Filecoin"}),", ",(0,i.jsx)(t.strong,{children:"Polkadot"}),", and many others are using libp2p to build their network stack."]}),"\n",(0,i.jsx)(t.p,{children:"The ongoing development and adoption of libp2p underscore its critical role in decentralized technologies, making it an ideal choice for this system. The learning curve of this library is the only downside. While for simple projects, the library can be easily introduced and used, for complex projects it can be difficult to manipulate and understand all the features to reach the desired result."}),"\n",(0,i.jsx)(t.p,{children:"Moreover, in this case, the library is not designed to be used on top of the Tor network, so it requires additional workarounds to make it feasible."}),"\n",(0,i.jsxs)(t.p,{children:["The initial attempts to use this library in a 'hacky' way (modifying the library code directly, which is not considered correct from a design perspective) were aborted because of the ",(0,i.jsx)(t.strong,{children:"multiaddr"})," resolution.",(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.em,{children:"Multiaddr"})," is a flexible and multi-protocol address format used for identifying peers in a decentralized, peer-to-peer network. It allows a single identifier to represent a peer using multiple transport protocols and addresses."]}),"\n",(0,i.jsx)(t.p,{children:"Furthermore, for each update or fix of the library, it was necessary to manually modify the involved files or keep a fork of the library, which introduced security implications. This goes against good security and software engineering practices, so this development line was abandoned."}),"\n",(0,i.jsxs)(t.p,{children:["After discarding this possibility, an analysis and feasibility study was conducted to implement a new module for the library that could extend its functionality to support communications over the Tor network. What emerged is that the ",(0,i.jsx)(t.strong,{children:(0,i.jsx)(t.a,{href:"https://www.npmjs.com/package/@libp2p/interface-transport",children:"Transport Interface"})})," needs to be implemented to make a new compliant module (like ",(0,i.jsx)(t.strong,{children:(0,i.jsx)(t.a,{href:"https://github.com/libp2p/js-libp2p-websockets",children:"js-libp2p-websockets"})}),"). I would have liked to contribute to the library, but the time was limited and the complexity of the task was high."]}),"\n",(0,i.jsx)(t.p,{children:"I should have investigated better where the library uses the UDP protocol to generate similar components that encapsulate this UDP traffic in TCP, possibly on Tor. Moreover, given the different nature of the two networks, it would have been necessary to implement a mechanism to manage different latencies, timeouts, name resolution mechanisms, and others in a cascading way."}),"\n",(0,i.jsx)(t.p,{children:"Given the limited time and the fact that this development line could not yet lead to a concrete result, the decision was made, with regret, to continue discarding this possibility and use native sockets for communication between peers. Anyway, this has been a very interesting part of the development, and it has been a great opportunity to understand better how the library works and how it can be extended. Surely, more work and study are needed to make this library (or at least some components) work on top of the Tor network, but the potential is very high."}),"\n",(0,i.jsx)(t.p,{children:"Another consideration regarding this possible development is that if I could have used the library, I could have focused on an even more complex system, moving towards an ecosystem concept. This, however, is normal in a prototype, where the focus is on the main abstractions and the quality of the architecture, and not on the complexity of the system."}),"\n",(0,i.jsx)(t.h3,{id:"native-sockets",children:"Native Sockets"}),"\n",(0,i.jsxs)(t.p,{children:["The communication between peers is managed through native sockets. The system uses the ",(0,i.jsx)(t.strong,{children:"Node.js"})," ",(0,i.jsx)(t.code,{children:"net"})," module to establish connections between peers. Also, in this case, the transport layer is changed according to the operating mode of the system, in particular, the usage of the ",(0,i.jsx)(t.strong,{children:"SOCKS5 Proxy"})," to ensure anonymity and privacy, or not."]}),"\n",(0,i.jsx)(t.p,{children:"To achieve this, the DIP (Dependency Inversion Principle) has been followed again, creating an interface that abstracts the communication layer and implementing two different classes, one for each mode."}),"\n",(0,i.jsx)(t.p,{children:"The main problem encountered in the anonymous mode is the management of the different latencies or network instability that can be introduced by the Tor network. To solve this problem, a retry mechanism has been implemented."})]})}function l(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},6498:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/exit-and-entry-nodes-ac16fe968a5737bd39905c617003ca8a.png"},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>a});var i=n(6540);const s={},o=i.createContext(s);function r(e){const t=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(o.Provider,{value:t},e.children)}}}]);